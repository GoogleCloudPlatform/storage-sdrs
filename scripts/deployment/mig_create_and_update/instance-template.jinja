
resources:
- name: {{ env["deployment"] }}-it
  type: compute.v1.instanceTemplate
  properties:
    properties:
      disks:
      - deviceName: boot
        type: PERSISTENT
        boot: true
        autoDelete: true
        initializeParams:
          sourceImage: {{ COMPUTE_URL_BASE }}projects/{{ env['project'] }}/global/images/centos-docker-sd
      machineType: {{ properties["machineType"] }}
      metadata:
        items:
        - key: startup-script-url
          value: {{ properties["value"] }}
      networkInterfaces:
      - network: {{ properties["network"] }}
        subnetwork: {{ properties["subnetwork"] }}
      serviceAccounts:
        - email: {{ properties["email"] }}
          scopes:
          - https://www.googleapis.com/auth/logging.write
          - https://www.googleapis.com/auth/monitoring.write
          - https://www.googleapis.com/auth/source.read_write
          - https://www.googleapis.com/auth/devstorage.read_only
          - https://www.googleapis.com/auth/servicecontrol
          - https://www.googleapis.com/auth/service.management.readonly
          - https://www.googleapis.com/auth/trace.append

        {% if properties["externalIp"] %}
        accessConfigs:
        - name: External-IP
          type: ONE_TO_ONE_NAT
        {% endif %}
